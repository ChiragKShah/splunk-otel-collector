@Library('sym-pipeline@CICD-1772') _

podTemplate(
  cloud: "kubernetes-build-sre-jenkins-agent",
  inheritFrom: 'jnlp',
  yaml: readTrusted('jenkins/podTemplate.yaml'),
  yamlMergeStrategy: merge()
) {
  node(POD_LABEL) {

    stage('Checkout') {
      def gitref = gitCheckout()
      def branch = BRANCH_NAME.replaceAll(/[\.-]/, "_")
    }

    buildGolangApp {
      buildDockerImage = true
      dockerRepository = "us-east4-docker.pkg.dev/sym-prod-mr-tools-01/sre-docker-us-east4"
      dockerTag = "${branch}-${BUILD_NUMBER}-${gitref}"
    }
  }
}